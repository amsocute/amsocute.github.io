<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>р╕гр╕░р╕Ър╕Ър╕гр╕▓р╕вр╣Др╕Фр╣Йр╕Хр╕╣р╣Й</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 min-h-screen font-sans p-6">
  <h1 class="text-3xl font-bold text-[#ff6b2c] mb-6 text-center">ЁЯУК р╕гр╕░р╕Ър╕Ър╕гр╕▓р╕вр╣Др╕Фр╣Йр╕Хр╕╣р╣Й</h1>

  <!-- р╕зр╕▒р╕Щр╕Чр╕╡р╣И -->
  <div class="mb-6 max-w-sm">
    <label class="block mb-2 font-semibold text-gray-700">ЁЯУЕ р╕зр╕▒р╕Щр╕Чр╕╡р╣И</label>
    <input type="date" id="date" class="border-2 border-gray-300 rounded-lg p-2 w-full focus:outline-none focus:border-[#ff6b2c] text-lg">
    <p id="formattedDate" class="text-gray-600 mt-1"></p>
  </div>

  <!-- р╕Ыр╕╕р╣Ир╕б -->
  <div class="mb-6 flex flex-wrap gap-3">
    <button id="addBranch" class="bg-green-500 hover:bg-green-600 text-white font-semibold py-2 px-5 rounded-lg shadow">тЮХ р╣Ар╕Юр╕┤р╣Ир╕бр╕кр╕▓р╕Вр╕▓</button>
    <button id="reset" class="bg-red-500 hover:bg-red-600 text-white font-semibold py-2 px-5 rounded-lg shadow">ЁЯФД р╕гр╕╡р╣Ар╕Лр╣Зр╕Хр╕Др╣Ир╕▓р╣Ар╕гр╕┤р╣Ир╕бр╕Хр╣Йр╕Щ</button>
    <button id="exportCSV" class="bg-blue-500 hover:bg-blue-600 text-white font-semibold py-2 px-5 rounded-lg shadow">ЁЯУЭ р╕нр╕нр╕Бр╕гр╕▓р╕вр╕Зр╕▓р╕Щ CSV</button>
  </div>

  <!-- р╕Хр╕▓р╕гр╕▓р╕З -->
  <div class="overflow-x-auto mb-8">
    <table id="branchesTable" class="w-full border text-sm bg-white rounded-xl shadow">
      <thead>
        <tr class="border-b bg-[#ff6b2c]/20">
          <th class="py-2 px-2 text-left">ЁЯПв р╕кр╕▓р╕Вр╕▓</th>
          <th class="py-2 px-2 text-left">ЁЯТ╡ р╕гр╕▓р╕вр╣Др╕Фр╣Й (THB)</th>
          <th class="py-2 px-2 text-left">ЁЯУК % р╣Ар╕Бр╣Зр╕Ъ</th>
          <th class="py-2 px-2 text-left text-red-500">ЁЯТ╕ р╕Др╣Ир╕▓р╣Гр╕Кр╣Йр╕Ир╣Ир╕▓р╕в</th>
          <th class="py-2 px-2 text-left text-green-600">ЁЯУИ р╕Бр╕│р╣Др╕г</th>
          <th class="py-2 px-2 text-left">ЁЯУН р╣Вр╕ер╣Ар╕Др╕Кр╕▒р╣Ир╕Щ</th>
          <th class="py-2 px-2 text-left">ЁЯЧСя╕П р╕ер╕Ъ</th>
        </tr>
      </thead>
      <tbody id="branchesBody"></tbody>
    </table>
  </div>

  <!-- р╕Др╣Ир╕▓р╣Гр╕Кр╣Йр╕Ир╣Ир╕▓р╕вр╣Ар╕Юр╕┤р╣Ир╕бр╣Ар╕Хр╕┤р╕б -->
  <div class="max-w-sm mb-8 bg-white p-4 rounded-xl shadow">
    <h2 class="text-lg font-semibold mb-3 text-gray-700">ЁЯЫТ р╕Др╣Ир╕▓р╣Гр╕Кр╣Йр╕Ир╣Ир╕▓р╕вр╣Ар╕Юр╕┤р╣Ир╕бр╣Ар╕Хр╕┤р╕б</h2>
    <div class="space-y-3">
      <div>
        <label>ЁЯЧУя╕П р╕Др╣Ир╕▓р╣Гр╕Кр╣Йр╕Ир╣Ир╕▓р╕вр╕гр╕▓р╕вр╕зр╕▒р╕Щ</label>
        <input type="number" id="daily" class="border rounded p-2 w-full focus:border-[#ff6b2c] focus:outline-none text-right">
      </div>
      <div>
        <label>тЫ╜ р╕Др╣Ир╕▓р╕Щр╣Йр╕│р╕бр╕▒р╕Щ</label>
        <input type="number" id="fuel" class="border rounded p-2 w-full focus:border-[#ff6b2c] focus:outline-none text-right">
      </div>
      <div>
        <label>ЁЯНЬ р╕Др╣Ир╕▓р╕нр╕▓р╕лр╕▓р╕г</label>
        <input type="number" id="food" class="border rounded p-2 w-full focus:border-[#ff6b2c] focus:outline-none text-right">
      </div>
      <div>
        <label>ЁЯУж р╕нр╕╖р╣Ир╕Щ р╣Ж</label>
        <input type="number" id="other" class="border rounded p-2 w-full focus:border-[#ff6b2c] focus:outline-none text-right">
      </div>
    </div>
  </div>

  <!-- р╕кр╕гр╕╕р╕Ы -->
  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
    <div id="summary1" class="bg-[#ff6b2c]/10 p-5 rounded-xl shadow space-y-3 text-center"></div>
    <div id="summary2" class="bg-[#ff6b2c]/10 p-5 rounded-xl shadow space-y-3 text-center"></div>
  </div>

<script>
const INITIAL_BRANCHES = 10;
let branches = Array.from({length: INITIAL_BRANCHES}, (_, i)=>({name:`р╕кр╕▓р╕Вр╕▓ ${i+1}`, income:0, percent:30, location:""}));

const monthsTH = ["р╕бр╕Бр╕гр╕▓р╕Др╕б","р╕Бр╕╕р╕бр╕ар╕▓р╕Юр╕▒р╕Щр╕Шр╣М","р╕бр╕╡р╕Щр╕▓р╕Др╕б","р╣Ар╕бр╕йр╕▓р╕вр╕Щ","р╕Юр╕др╕йр╕ар╕▓р╕Др╕б","р╕бр╕┤р╕Цр╕╕р╕Щр╕▓р╕вр╕Щ",
                  "р╕Бр╕гр╕Бр╕Ор╕▓р╕Др╕б","р╕кр╕┤р╕Зр╕лр╕▓р╕Др╕б","р╕Бр╕▒р╕Щр╕вр╕▓р╕вр╕Щ","р╕Хр╕╕р╕ер╕▓р╕Др╕б","р╕Юр╕др╕ир╕Ир╕┤р╕Бр╕▓р╕вр╕Щ","р╕Шр╕▒р╕Щр╕зр╕▓р╕Др╕б"];

function formatThaiDate(dateStr){
  if(!dateStr) return "";
  const [year,month,day]=dateStr.split("-").map(Number);
  return `${day} ${monthsTH[month-1]} ${year+543}`;
}

function renderTable(){
  const tbody = document.getElementById("branchesBody");
  tbody.innerHTML="";
  branches.forEach((b,i)=>{
    const cost = (b.income*b.percent)/100;
    const profit = b.income-cost;
    const tr = document.createElement("tr");
    tr.className="border-b hover:bg-gray-50";
    tr.innerHTML=`
      <td class="py-1 px-2"><input type="text" value="${b.name}" class="w-full border rounded p-2 text-sm focus:border-[#ff6b2c] focus:outline-none"></td>
      <td class="py-1 px-2 text-right">
        <div class="flex items-center">
          <button class="bg-gray-300 px-2 rounded-l">-</button>
          <input type="text" value="${b.income}" class="w-20 text-right border-t border-b border-gray-300 focus:outline-none">
          <button class="bg-gray-300 px-2 rounded-r">+</button>
        </div>
      </td>
      <td class="py-1 px-2 text-center">
        <div class="flex items-center justify-center">
          <button class="bg-gray-300 px-2 rounded-l">-</button>
          <input type="text" value="${b.percent}" class="w-12 text-center border-t border-b border-gray-300 focus:outline-none">
          <button class="bg-gray-300 px-2 rounded-r">+</button>
        </div>
      </td>
      <td class="py-1 px-2 text-red-500 font-bold text-right">${cost.toLocaleString()}</td>
      <td class="py-1 px-2 text-green-600 font-bold text-right">${profit.toLocaleString()}</td>
      <td class="py-1 px-2"><input type="text" value="${b.location}" class="w-full border rounded p-2 text-sm focus:border-[#ff6b2c] focus:outline-none"></td>
      <td class="py-1 px-2 text-center"><button class="bg-red-500 hover:bg-red-600 text-white py-1 px-3 rounded text-xs">р╕ер╕Ъ</button></td>
    `;
    tbody.appendChild(tr);

    // р╕кр╕▓р╕Вр╕▓
    tr.children[0].querySelector("input").addEventListener("input",(e)=>{b.name=e.target.value});

    // р╕гр╕▓р╕вр╣Др╕Фр╣Й
    const incomeInput = tr.children[1].querySelector("input");
    incomeInput.addEventListener("input",(e)=>{b.income=parseInt(e.target.value)||0});
    tr.children[1].querySelectorAll("button")[0].addEventListener("click",()=>{b.income-=100; if(b.income<0)b.income=0; renderTable()});
    tr.children[1].querySelectorAll("button")[1].addEventListener("click",()=>{b.income+=100; renderTable()});

    // р╣Ар╕Ыр╕нр╕гр╣Мр╣Ар╕Лр╣Зр╕Щр╕Хр╣М
    const percInput = tr.children[2].querySelector("input");
    percInput.addEventListener("input",(e)=>{b.percent=parseInt(e.target.value)||30; if(b.percent<30)b.percent=30;if(b.percent>50)b.percent=50});
    tr.children[2].querySelectorAll("button")[0].addEventListener("click",()=>{b.percent-=5;if(b.percent<30)b.percent=30; renderTable()});
    tr.children[2].querySelectorAll("button")[1].addEventListener("click",()=>{b.percent+=5;if(b.percent>50)b.percent=50; renderTable()});

    // р╣Вр╕ер╣Ар╕Др╕Кр╕▒р╣Ир╕Щ
    tr.children[5].querySelector("input").addEventListener("input",(e)=>{b.location=e.target.value});

    // р╕ер╕Ъ
    tr.children[6].querySelector("button").addEventListener("click",()=>{
      branches.splice(i,1);
      renderTable();
    });
  });

  renderSummary();
}

function getExpenses(){
  return {
    daily:parseInt(document.getElementById("daily").value)||0,
    fuel:parseInt(document.getElementById("fuel").value)||0,
    food:parseInt(document.getElementById("food").value)||0,
    other:parseInt(document.getElementById("other").value)||0
  };
}

function renderSummary(){
  const totalIncome = branches.reduce((a,b)=>a+b.income,0);
  const totalBranchCost = branches.reduce((a,b)=>a+(b.income*b.percent/100),0);
  const totalBranchProfit = totalIncome-totalBranchCost;
  const expenses = getExpenses();
  const totalExpenses = expenses.daily+expenses.fuel+expenses.food+expenses.other;
  const finalProfit = totalBranchProfit-totalExpenses;
  const avgPercent = branches.length?branches.reduce((a,b)=>a+b.percent,0)/branches.length:0;

  document.getElementById("summary1").innerHTML=`
    <p class="text-xl font-semibold text-gray-700">ЁЯТ╡ р╕гр╕зр╕бр╕гр╕▓р╕вр╣Др╕Фр╣Й: ${totalIncome.toLocaleString()} р╕Ър╕▓р╕Ч</p>
    <p class="text-xl font-semibold text-red-500">ЁЯТ╕ р╕Др╣Ир╕▓р╣Гр╕Кр╣Йр╕Ир╣Ир╕▓р╕вр╕кр╕▓р╕Вр╕▓ (${avgPercent.toFixed(0)}%): ${totalBranchCost.toLocaleString()} р╕Ър╕▓р╕Ч</p>
    <p class="text-xl font-semibold text-green-600">ЁЯУИ р╕Бр╕│р╣Др╕гр╕кр╕▓р╕Вр╕▓: ${totalBranchProfit.toLocaleString()} р╕Ър╕▓р╕Ч</p>
  `;
  document.getElementById("summary2").innerHTML=`
    <p class="text-xl font-semibold text-red-500">ЁЯЫТ р╕Др╣Ир╕▓р╣Гр╕Кр╣Йр╕Ир╣Ир╕▓р╕вр╣Ар╕Юр╕┤р╣Ир╕бр╣Ар╕Хр╕┤р╕б: ${totalExpenses.toLocaleString()} р╕Ър╕▓р╕Ч</p>
    <p class="text-2xl font-bold text-green-600">тЬЕ р╕Бр╕│р╣Др╕гр╕кр╕╕р╕Чр╕Шр╕┤: ${finalProfit.toLocaleString()} р╕Ър╕▓р╕Ч</p>
  `;
}

// р╕Ыр╕╕р╣Ир╕б
document.getElementById("addBranch").addEventListener("click",()=>{
  branches.push({name:`р╕кр╕▓р╕Вр╕▓ ${branches.length+1}`, income:0, percent:30, location:""});
  renderTable();
});
document.getElementById("reset").addEventListener("click",()=>{
  branches=Array.from({length:INITIAL_BRANCHES}, (_,i)=>({name:`р╕кр╕▓р╕Вр╕▓ ${i+1}`, income:0, percent:30, location:""}));
  document.getElementById("daily").value="";
  document.getElementById("fuel").value="";
  document.getElementById("food").value="";
  document.getElementById("other").value="";
  document.getElementById("date").value="";
  document.getElementById("formattedDate").textContent="";
  renderTable();
});
document.getElementById("exportCSV").addEventListener("click",()=>{
  const header=["р╕зр╕▒р╕Щр╕Чр╕╡р╣И","р╕кр╕▓р╕Вр╕▓","р╕гр╕▓р╕вр╣Др╕Фр╣Й (р╕Ър╕▓р╕Ч)","% р╣Ар╕Бр╣Зр╕Ъ","р╕Др╣Ир╕▓р╣Гр╕Кр╣Йр╕Ир╣Ир╕▓р╕в (р╕Ър╕▓р╕Ч)","р╕Бр╕│р╣Др╕г (р╕Ър╕▓р╕Ч)","р╣Вр╕ер╣Ар╕Др╕Кр╕▒р╣Ир╕Щ"];
  const date = document.getElementById("date").value;
  const dateRow=[formatThaiDate(date),"","","","","",""];
  const rows = branches.map(b=>["",b.name,b.income,b.percent,(b.income*b.percent/100),(b.income-(b.income*b.percent/100)),b.location]);
  const expenses=getExpenses();
  const summary=[
    ["","р╕гр╕зр╕бр╕гр╕▓р╕вр╣Др╕Фр╣Й", branches.reduce((a,b)=>a+b.income,0)],
    ["","р╕Др╣Ир╕▓р╣Гр╕Кр╣Йр╕Ир╣Ир╕▓р╕вр╕кр╕▓р╕Вр╕▓", branches.reduce((a,b)=>a+(b.income*b.percent/100),0)],
    ["","р╕Бр╕│р╣Др╕гр╕кр╕▓р╕Вр╕▓", branches.reduce((a,b)=>a+b.income-(b.income*b.percent/100),0)],
    ["","р╕Др╣Ир╕▓р╣Гр╕Кр╣Йр╕Ир╣Ир╕▓р╕вр╣Ар╕Юр╕┤р╣Ир╕бр╣Ар╕Хр╕┤р╕б", expenses.daily+expenses.fuel+expenses.food+expenses.other],
    ["","р╕Бр╕│р╣Др╕гр╕кр╕╕р╕Чр╕Шр╕┤",(branches.reduce((a,b)=>a+b.income-(b.income*b.percent/100),0)-(expenses.daily+expenses.fuel+expenses.food+expenses.other))]
  ];
  const csvContent="\uFEFF"+[header,dateRow,...rows,[],...summary].map(r=>r.join(",")).join("\n");
  const blob=new Blob([csvContent], {type:"text/csv;charset=utf-8;"});
  const link=document.createElement("a");
  link.href=URL.createObjectURL(blob);
  link.setAttribute("download",`р╕гр╕▓р╕вр╕Зр╕▓р╕Щ_${date||"р╣Др╕бр╣Ир╕гр╕░р╕Ър╕╕р╕зр╕▒р╕Щр╕Чр╕╡р╣И"}.csv`);
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
});

// р╕зр╕▒р╕Щр╕Чр╕╡р╣И
document.getElementById("date").addEventListener("input",(e)=>{
  document.getElementById("formattedDate").textContent="р╕зр╕▒р╕Щр╕Чр╕╡р╣Ир╕Чр╕╡р╣Ир╣Ар╕ер╕╖р╕нр╕Б: "+formatThaiDate(e.target.value);
});

// р╕Др╣Ир╕▓р╣Гр╕Кр╣Йр╕Ир╣Ир╕▓р╕в
["daily","fuel","food","other"].forEach(id=>{
  document.getElementById(id).addEventListener("input",renderSummary);
});

// Render р╕Др╕гр╕▒р╣Йр╕Зр╣Бр╕гр╕Б
renderTable();
</script>
</body>
</html>
