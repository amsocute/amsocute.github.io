<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏ï‡∏π‡πâ</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+Thai:wght@300;400;500;600;700&display=swap');
    
    body {
      font-family: 'Noto Sans Thai', sans-serif;
      background: linear-gradient(135deg, #f5f7fa 0%, #e4e9f2 100%);
    }
    
    .glass-effect {
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(10px);
      border-radius: 16px;
      box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
      border: 1px solid rgba(255, 255, 255, 0.18);
    }
    
    .btn-primary {
      background: linear-gradient(45deg, #ff6b2c, #ff8e53);
      transition: all 0.3s ease;
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 7px 14px rgba(255, 107, 44, 0.3);
    }
    
    .btn-success {
      background: linear-gradient(45deg, #56ab2f, #a8e6cf);
      transition: all 0.3s ease;
    }
    
    .btn-success:hover {
      transform: translateY(-2px);
      box-shadow: 0 7px 14px rgba(86, 171, 47, 0.3);
    }
    
    .btn-danger {
      background: linear-gradient(45deg, #ff416c, #ff4b2b);
      transition: all 0.3s ease;
    }
    
    .btn-danger:hover {
      transform: translateY(-2px);
      box-shadow: 0 7px 14px rgba(255, 65, 108, 0.3);
    }
    
    .btn-info {
      background: linear-gradient(45deg, #2196F3, #21CBF3);
      transition: all 0.3s ease;
    }
    
    .btn-info:hover {
      transform: translateY(-2px);
      box-shadow: 0 7px 14px rgba(33, 150, 243, 0.3);
    }
    
    .btn-calculate {
      background: linear-gradient(45deg, #9c27b0, #e040fb);
      transition: all 0.3s ease;
    }
    
    .btn-calculate:hover {
      transform: translateY(-2px);
      box-shadow: 0 7px 14px rgba(156, 39, 176, 0.3);
    }
    
    .btn-send {
      background: linear-gradient(45deg, #00b09b, #96c93d);
      transition: all 0.3s ease;
    }
    
    .btn-send:hover {
      transform: translateY(-2px);
      box-shadow: 0 7px 14px rgba(0, 176, 155, 0.3);
    }
    
    .btn-load {
      background: linear-gradient(45deg, #3f51b5, #7986cb);
      transition: all 0.3s ease;
    }
    
    .btn-load:hover {
      transform: translateY(-2px);
      box-shadow: 0 7px 14px rgba(63, 81, 181, 0.3);
    }
    
    .income-input {
      transition: all 0.3s ease;
    }
    
    .income-input:focus {
      transform: scale(1.02);
      box-shadow: 0 0 0 3px rgba(255, 107, 44, 0.2);
    }
    
    .card {
      transition: all 0.3s ease;
    }
    
    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
    }
    
    .table-row {
      transition: all 0.2s ease;
    }
    
    .table-row:hover {
      background-color: rgba(255, 107, 44, 0.05);
    }
    
    .summary-card {
      background: linear-gradient(135deg, #ff6b2c 0%, #ff8e53 100%);
      color: white;
      transition: all 0.3s ease;
    }
    
    .summary-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 20px rgba(255, 107, 44, 0.3);
    }
    
    .expense-card {
      background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%);
      color: white;
      transition: all 0.3s ease;
    }
    
    .expense-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 20px rgba(86, 171, 47, 0.3);
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }
    
    .fade-in {
      animation: fadeIn 0.5s ease forwards;
    }
    
    .pulse {
      animation: pulse 1s infinite;
    }
    
    .btn-icon {
      transition: all 0.2s ease;
    }
    
    .btn-icon:hover {
      transform: scale(1.1);
    }
    
    /* Modal Styles */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(5px);
      animation: fadeIn 0.3s ease;
    }
    
    .modal-content {
      background-color: white;
      margin: 10% auto;
      padding: 0;
      border-radius: 20px;
      width: 90%;
      max-width: 500px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      animation: slideIn 0.4s ease;
      overflow: hidden;
    }
    
    @keyframes slideIn {
      from { transform: translateY(-50px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    
    .modal-header {
      background: linear-gradient(45deg, #ff6b2c, #ff8e53);
      color: white;
      padding: 20px;
      text-align: center;
      position: relative;
    }
    
    .modal-header.reset {
      background: linear-gradient(45deg, #ff416c, #ff4b2b);
    }
    
    .modal-header.send {
      background: linear-gradient(45deg, #00b09b, #96c93d);
    }
    
    .modal-header.load {
      background: linear-gradient(45deg, #3f51b5, #7986cb);
    }
    
    .modal-body {
      padding: 25px;
      text-align: center;
    }
    
    .modal-footer {
      padding: 15px 25px;
      text-align: center;
      background-color: #f8f9fa;
      border-top: 1px solid #e9ecef;
    }
    
    .close {
      position: absolute;
      right: 20px;
      top: 20px;
      color: white;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .close:hover {
      transform: rotate(90deg);
    }
    
    .summary-item {
      display: flex;
      justify-content: space-between;
      padding: 10px 0;
      border-bottom: 1px solid #eee;
    }
    
    .summary-item:last-child {
      border-bottom: none;
      font-weight: bold;
      font-size: 1.2em;
      color: #ff6b2c;
    }
    
    .loading-spinner {
      border: 4px solid rgba(0, 0, 0, 0.1);
      border-radius: 50%;
      border-top: 4px solid #3f51b5;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 0 auto 20px;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    /* ‡∏õ‡∏£‡∏±‡∏ö‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ */
    @media (max-width: 768px) {
      .mobile-input {
        font-size: 16px; /* ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£ zoom ‡πÄ‡∏°‡∏∑‡πà‡∏≠ focus ‡∏ö‡∏ô iOS */
      }
      
      .mobile-table-container {
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
      }
      
      .mobile-button {
        padding: 12px 16px;
        font-size: 16px;
      }
      
      .mobile-card {
        padding: 16px;
      }
      
      .modal-content {
        margin: 20% auto;
        width: 95%;
      }
      
      /* ‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡∏ä‡πà‡∏≠‡∏á‡∏™‡∏≤‡∏Ç‡∏≤‡πÉ‡∏´‡πâ‡πÉ‡∏´‡∏ç‡πà‡∏Ç‡∏∂‡πâ‡∏ô‡πÉ‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ */
      .branch-input {
        min-width: 150px !important;
        font-size: 16px !important;
        padding: 8px !important;
      }
      
      /* ‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÉ‡∏´‡πâ‡πÉ‡∏´‡∏ç‡πà‡∏Ç‡∏∂‡πâ‡∏ô‡πÉ‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ */
      .mobile-table {
        font-size: 14px !important;
      }
      
      .mobile-table td, .mobile-table th {
        padding: 8px 4px !important;
      }
      
      /* ‡∏õ‡∏£‡∏±‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡∏ä‡πà‡∏≠‡∏á‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡πÉ‡∏´‡πâ‡πÉ‡∏´‡∏ç‡πà‡∏Ç‡∏∂‡πâ‡∏ô‡πÉ‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ */
      .income-field {
        min-width: 100px !important;
        font-size: 16px !important;
      }
    }
    
    /* ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ä‡πà‡∏≠‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ */
    .search-container {
      position: relative;
      margin-bottom: 15px;
    }
    
    .search-input {
      width: 100%;
      padding: 12px 40px 12px 15px;
      border: 2px solid #e0e0e0;
      border-radius: 25px;
      font-size: 16px;
      outline: none;
      transition: all 0.3s ease;
    }
    
    .search-input:focus {
      border-color: #ff6b2c;
      box-shadow: 0 0 0 3px rgba(255, 107, 44, 0.2);
    }
    
    .search-icon {
      position: absolute;
      right: 15px;
      top: 50%;
      transform: translateY(-50%);
      color: #888;
    }
    
    .search-results {
      max-height: 300px;
      overflow-y: auto;
      margin-top: 15px;
    }
    
    .search-result-item {
      padding: 12px;
      border-bottom: 1px solid #eee;
      cursor: pointer;
      transition: background-color 0.2s;
    }
    
    .search-result-item:hover {
      background-color: #f5f5f5;
    }
    
    .search-result-item:last-child {
      border-bottom: none;
    }
    
    .search-result-date {
      font-weight: bold;
      color: #ff6b2c;
    }
    
    .search-result-time {
      color: #666;
      font-size: 14px;
    }
  </style>
</head>
<body class="min-h-screen p-2 md:p-8">
  <div class="max-w-7xl mx-auto">
    <!-- Header -->
    <header class="text-center mb-6 fade-in">
      <div class="inline-flex items-center justify-center bg-white rounded-full p-3 shadow-lg mb-3">
        <i class="fas fa-chart-line text-3xl text-[#ff6b2c]"></i>
      </div>
      <h1 class="text-3xl md:text-4xl font-bold text-[#ff6b2c] mb-2">‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏ï‡∏π‡πâ</h1>
      <p class="text-gray-600 text-sm md:text-base">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡πÅ‡∏•‡∏∞‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏π‡πâ‡∏Ç‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á</p>
    </header>

    <!-- Main Content -->
    <div class="grid grid-cols-1 gap-6 mb-6">
      <!-- Date Card -->
      <div class="glass-effect p-4 md:p-6 card fade-in mobile-card">
        <div class="flex items-center mb-3">
          <i class="fas fa-calendar-alt text-xl md:text-2xl text-[#ff6b2c] mr-3"></i>
          <h2 class="text-lg md:text-xl font-semibold text-gray-800">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</h2>
        </div>
        <div class="flex flex-col items-start gap-3">
          <input type="date" id="date" class="income-input mobile-input border-2 border-gray-200 rounded-xl p-3 w-full focus:outline-none focus:border-[#ff6b2c] text-lg">
          <div id="formattedDate" class="text-gray-600 bg-gray-100 px-4 py-2 rounded-lg font-medium w-full text-center"></div>
        </div>
      </div>

      <!-- Buttons -->
      <div class="glass-effect p-4 md:p-6 card fade-in mobile-card">
        <div class="grid grid-cols-2 gap-3">
          <button id="addBranch" class="btn-success text-white font-semibold py-3 px-4 rounded-xl shadow flex items-center justify-center mobile-button">
            <i class="fas fa-plus-circle mr-2"></i> <span>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏≤‡∏Ç‡∏≤</span>
          </button>
          <button id="reset" class="btn-danger text-white font-semibold py-3 px-4 rounded-xl shadow flex items-center justify-center mobile-button">
            <i class="fas fa-redo-alt mr-2"></i> <span>‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï</span>
          </button>
          <button id="exportCSV" class="btn-info text-white font-semibold py-3 px-4 rounded-xl shadow flex items-center justify-center mobile-button">
            <i class="fas fa-file-csv mr-2"></i> <span>‡∏≠‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</span>
          </button>
          <button id="calculate" class="btn-calculate text-white font-semibold py-3 px-4 rounded-xl shadow flex items-center justify-center mobile-button">
            <i class="fas fa-calculator mr-2"></i> <span>‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì</span>
          </button>
          <button id="sendData" class="btn-send text-white font-semibold py-3 px-4 rounded-xl shadow flex items-center justify-center mobile-button">
            <i class="fas fa-paper-plane mr-2"></i> <span>‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</span>
          </button>
          <button id="loadLatestData" class="btn-load text-white font-semibold py-3 px-4 rounded-xl shadow flex items-center justify-center mobile-button">
            <i class="fas fa-download mr-2"></i> <span>‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</span>
          </button>
          <button id="checkConnection" class="btn-info text-white font-semibold py-3 px-4 rounded-xl shadow flex items-center justify-center mobile-button">
            <i class="fas fa-wifi mr-2"></i> <span>‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠</span>
          </button>
        </div>
      </div>

      <!-- Branches Table -->
      <div class="glass-effect p-4 md:p-6 card overflow-hidden fade-in mobile-card">
        <div class="flex items-center mb-4">
          <i class="fas fa-store text-xl md:text-2xl text-[#ff6b2c] mr-3"></i>
          <h2 class="text-lg md:text-xl font-semibold text-gray-800">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≤‡∏Ç‡∏≤</h2>
        </div>
        <div class="mobile-table-container">
          <table class="w-full border-collapse mobile-table">
            <thead>
              <tr class="border-b-2 border-[#ff6b2c]/30 bg-[#ff6b2c]/10">
                <th class="py-2 px-2 md:px-4 text-left font-semibold text-gray-700 text-xs md:text-sm">
                  <i class="fas fa-building mr-1"></i><span class="hidden sm:inline">‡∏™‡∏≤‡∏Ç‡∏≤</span>
                </th>
                <th class="py-2 px-2 md:px-4 text-left font-semibold text-gray-700 text-xs md:text-sm">
                  <i class="fas fa-money-bill-wave mr-1"></i><span class="hidden sm:inline">‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ</span>
                </th>
                <th class="py-2 px-2 md:px-4 text-left font-semibold text-gray-700 text-xs md:text-sm">
                  <i class="fas fa-percentage mr-1"></i><span class="hidden sm:inline">% ‡πÄ‡∏Å‡πá‡∏ö</span>
                </th>
                <th class="py-2 px-2 md:px-4 text-left font-semibold text-red-600 text-xs md:text-sm">
                  <i class="fas fa-hand-holding-usd mr-1"></i><span class="hidden sm:inline">‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢</span>
                </th>
                <th class="py-2 px-2 md:px-4 text-left font-semibold text-green-600 text-xs md:text-sm">
                  <i class="fas fa-chart-line mr-1"></i><span class="hidden sm:inline">‡∏Å‡∏≥‡πÑ‡∏£</span>
                </th>
                <th class="py-2 px-2 md:px-4 text-left font-semibold text-gray-700 text-xs md:text-sm">
                  <i class="fas fa-map-marker-alt mr-1"></i><span class="hidden sm:inline">‡πÇ‡∏•‡πÄ‡∏Ñ‡∏ä‡∏±‡πà‡∏ô</span>
                </th>
                <th class="py-2 px-2 md:px-4 text-center font-semibold text-gray-700 text-xs md:text-sm">
                  <i class="fas fa-trash-alt mr-1"></i><span class="hidden sm:inline">‡∏•‡∏ö</span>
                </th>
              </tr>
            </thead>
            <tbody id="branchesBody"></tbody>
          </table>
        </div>
      </div>

      <!-- Additional Expenses -->
      <div class="glass-effect p-4 md:p-6 card fade-in mobile-card">
        <div class="flex items-center mb-4">
          <i class="fas fa-shopping-cart text-xl md:text-2xl text-[#ff6b2c] mr-3"></i>
          <h2 class="text-lg md:text-xl font-semibold text-gray-800">‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°</h2>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label class="block mb-2 font-medium text-gray-700 text-sm md:text-base">
              <i class="fas fa-calendar-day mr-2 text-[#ff6b2c]"></i>‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô
            </label>
            <div class="flex items-center">
              <button class="btn-icon bg-gray-200 hover:bg-gray-300 px-3 py-2 rounded-l-lg border border-gray-300">
                <i class="fas fa-minus"></i>
              </button>
              <div class="relative flex-grow">
                <input type="number" id="daily" class="income-input mobile-input border-2 border-gray-200 w-full focus:outline-none focus:border-[#ff6b2c] text-right pr-10 py-2">
                <span class="absolute right-3 top-2 text-gray-500">‡∏ø</span>
              </div>
              <button class="btn-icon bg-gray-200 hover:bg-gray-300 px-3 py-2 rounded-r-lg border border-gray-300">
                <i class="fas fa-plus"></i>
              </button>
            </div>
          </div>
          <div>
            <label class="block mb-2 font-medium text-gray-700 text-sm md:text-base">
              <i class="fas fa-gas-pump mr-2 text-[#ff6b2c]"></i>‡∏Ñ‡πà‡∏≤‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô
            </label>
            <div class="flex items-center">
              <button class="btn-icon bg-gray-200 hover:bg-gray-300 px-3 py-2 rounded-l-lg border border-gray-300">
                <i class="fas fa-minus"></i>
              </button>
              <div class="relative flex-grow">
                <input type="number" id="fuel" class="income-input mobile-input border-2 border-gray-200 w-full focus:outline-none focus:border-[#ff6b2c] text-right pr-10 py-2">
                <span class="absolute right-3 top-2 text-gray-500">‡∏ø</span>
              </div>
              <button class="btn-icon bg-gray-200 hover:bg-gray-300 px-3 py-2 rounded-r-lg border border-gray-300">
                <i class="fas fa-plus"></i>
              </button>
            </div>
          </div>
          <div>
            <label class="block mb-2 font-medium text-gray-700 text-sm md:text-base">
              <i class="fas fa-utensils mr-2 text-[#ff6b2c]"></i>‡∏Ñ‡πà‡∏≤‡∏≠‡∏≤‡∏´‡∏≤‡∏£
            </label>
            <div class="flex items-center">
              <button class="btn-icon bg-gray-200 hover:bg-gray-300 px-3 py-2 rounded-l-lg border border-gray-300">
                <i class="fas fa-minus"></i>
              </button>
              <div class="relative flex-grow">
                <input type="number" id="food" class="income-input mobile-input border-2 border-gray-200 w-full focus:outline-none focus:border-[#ff6b2c] text-right pr-10 py-2">
                <span class="absolute right-3 top-2 text-gray-500">‡∏ø</span>
              </div>
              <button class="btn-icon bg-gray-200 hover:bg-gray-300 px-3 py-2 rounded-r-lg border border-gray-300">
                <i class="fas fa-plus"></i>
              </button>
            </div>
          </div>
          <div>
            <label class="block mb-2 font-medium text-gray-700 text-sm md:text-base">
              <i class="fas fa-box mr-2 text-[#ff6b2c]"></i>‡∏≠‡∏∑‡πà‡∏ô ‡πÜ
            </label>
            <div class="flex items-center">
              <button class="btn-icon bg-gray-200 hover:bg-gray-300 px-3 py-2 rounded-l-lg border border-gray-300">
                <i class="fas fa-minus"></i>
              </button>
              <div class="relative flex-grow">
                <input type="number" id="other" class="income-input mobile-input border-2 border-gray-200 w-full focus:outline-none focus:border-[#ff6b2c] text-right pr-10 py-2">
                <span class="absolute right-3 top-2 text-gray-500">‡∏ø</span>
              </div>
              <button class="btn-icon bg-gray-200 hover:bg-gray-300 px-3 py-2 rounded-r-lg border border-gray-300">
                <i class="fas fa-plus"></i>
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Summary Cards -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div class="summary-card p-4 md:p-6 rounded-xl shadow-lg card fade-in mobile-card">
          <div class="flex items-center mb-4">
            <i class="fas fa-chart-pie text-xl md:text-2xl mr-3"></i>
            <h2 class="text-lg md:text-xl font-semibold">‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ</h2>
          </div>
          <div id="summary1" class="space-y-3"></div>
        </div>
        
        <div class="expense-card p-4 md:p-6 rounded-xl shadow-lg card fade-in mobile-card">
          <div class="flex items-center mb-4">
            <i class="fas fa-wallet text-xl md:text-2xl mr-3"></i>
            <h2 class="text-lg md:text-xl font-semibold">‡∏™‡∏£‡∏∏‡∏õ‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢</h2>
          </div>
          <div id="summary2" class="space-y-3"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Calculate Modal -->
  <div id="calculateModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <span class="close" onclick="closeModal('calculateModal')">&times;</span>
        <h2><i class="fas fa-calculator mr-2"></i>‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì</h2>
      </div>
      <div class="modal-body">
        <div class="mb-4">
          <i class="fas fa-check-circle text-5xl text-green-500 mb-3"></i>
          <p class="text-lg">‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô!</p>
        </div>
        <div id="modalSummary" class="text-left bg-gray-50 p-4 rounded-lg">
          <!-- ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà -->
        </div>
      </div>
      <div class="modal-footer">
        <button onclick="closeModal('calculateModal')" class="btn-calculate text-white font-semibold py-2 px-6 rounded-lg">
          ‡∏ï‡∏Å‡∏•‡∏á
        </button>
      </div>
    </div>
  </div>

  <!-- Reset Modal -->
  <div id="resetModal" class="modal">
    <div class="modal-content">
      <div class="modal-header reset">
        <span class="close" onclick="closeModal('resetModal')">&times;</span>
        <h2><i class="fas fa-exclamation-triangle mr-2"></i>‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï</h2>
      </div>
      <div class="modal-body">
        <div class="mb-4">
          <i class="fas fa-question-circle text-5xl text-yellow-500 mb-3"></i>
          <p class="text-lg">‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î?</p>
          <p class="text-gray-600">‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏î‡πâ</p>
        </div>
      </div>
      <div class="modal-footer">
        <button onclick="closeModal('resetModal')" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold py-2 px-6 rounded-lg mr-3">
          ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
        </button>
        <button onclick="confirmReset()" class="btn-danger text-white font-semibold py-2 px-6 rounded-lg">
          ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï
        </button>
      </div>
    </div>
  </div>

  <!-- Send Data Modal -->
  <div id="sendDataModal" class="modal">
    <div class="modal-content">
      <div class="modal-header send">
        <span class="close" onclick="closeModal('sendDataModal')">&times;</span>
        <h2><i class="fas fa-paper-plane mr-2"></i>‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡∏¢‡∏±‡∏á Google Sheet</h2>
      </div>
      <div class="modal-body">
        <div id="sendStatus" class="mb-4">
          <!-- ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà -->
        </div>
        <div id="modalSendSummary" class="text-left bg-gray-50 p-4 rounded-lg">
          <!-- ‡∏™‡∏£‡∏∏‡∏õ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏™‡πà‡∏á‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà -->
        </div>
      </div>
      <div class="modal-footer">
        <button onclick="closeModal('sendDataModal')" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold py-2 px-6 rounded-lg mr-3">
          ‡∏õ‡∏¥‡∏î
        </button>
        <button id="confirmSend" class="btn-send text-white font-semibold py-2 px-6 rounded-lg">
          ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á
        </button>
      </div>
    </div>
  </div>

  <!-- Load Latest Data Modal -->
  <div id="loadLatestDataModal" class="modal">
    <div class="modal-content">
      <div class="modal-header load">
        <span class="close" onclick="closeModal('loadLatestDataModal')">&times;</span>
        <h2><i class="fas fa-download mr-2"></i>‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏à‡∏≤‡∏Å Google Sheet</h2>
      </div>
      <div class="modal-body">
        <div id="loadLatestStatus" class="mb-4">
          <!-- ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà -->
        </div>
        <div id="modalLoadLatestSummary" class="text-left bg-gray-50 p-4 rounded-lg">
          <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏î‡∏∂‡∏á‡∏°‡∏≤‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà -->
        </div>
      </div>
      <div class="modal-footer">
        <button onclick="closeModal('loadLatestDataModal')" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold py-2 px-6 rounded-lg mr-3">
          ‡∏õ‡∏¥‡∏î
        </button>
        <button id="confirmLoadLatest" class="btn-load text-white font-semibold py-2 px-6 rounded-lg" style="display: none;">
          ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
        </button>
      </div>
    </div>
  </div>

  <!-- Audio elements for sound effects -->
  <audio id="calculateSound" preload="auto">
    <source src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBSuBzvLZiTYIG2m98OScTgwOUarm7blmFgU7k9n1unEiBC13yO/eizEIHWq+8+OWT" type="audio/wav">
  </audio>
  <audio id="resetSound" preload="auto">
    <source src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBSuBzvLZiTYIG2m98OScTgwOUarm7blmFgU7k9n1unEiBC13yO/eizEIHWq+8+OWT" type="audio/wav">
  </audio>
  <audio id="sendSound" preload="auto">
    <source src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBSuBzvLZiTYIG2m98OScTgwOUarm7blmFgU7k9n1unEiBC13yO/eizEIHWq+8+OWT" type="audio/wav">
  </audio>
  <audio id="loadSound" preload="auto">
    <source src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBSuBzvLZiTYIG2m98OScTgwOUarm7blmFgU7k9n1unEiBC13yO/eizEIHWq+8+OWT" type="audio/wav">
  </audio>

<script>
const INITIAL_BRANCHES = 10;
let branches = Array.from({length: INITIAL_BRANCHES}, (_, i)=>({name:`‡∏™‡∏≤‡∏Ç‡∏≤ ${i+1}`, income:0, percent:30, location:""}));

const monthsTH = ["‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°","‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå","‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°","‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô","‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°","‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô",
                  "‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°","‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°","‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô","‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°","‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô","‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°"];

function formatThaiDate(dateStr){
  if(!dateStr) return "";
  
  try {
    const [year,month,day]=dateStr.split("-").map(Number);
    
    // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡πà‡∏≤‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
    if(isNaN(year) || isNaN(month) || isNaN(day) || month < 1 || month > 12 || day < 1 || day > 31) {
      return "";
    }
    
    return `${day} ${monthsTH[month-1]} ${year+543}`;
  } catch (e) {
    console.error("Error formatting date:", e);
    return "";
  }
}

function renderTable(){
  const tbody = document.getElementById("branchesBody");
  tbody.innerHTML="";
  branches.forEach((b,i)=>{
    const cost = (b.income*b.percent)/100;
    const profit = b.income-cost;
    const tr = document.createElement("tr");
    tr.className="border-b table-row";
    tr.innerHTML=`
      <td class="py-2 px-2 md:px-4">
        <input type="text" value="${b.name}" class="w-full border-2 border-gray-200 rounded-lg p-1 md:p-2 text-xs md:text-sm focus:border-[#ff6b2c] focus:outline-none transition-all mobile-input branch-input">
      </td>
      <td class="py-2 px-2 md:px-4">
        <div class="flex items-center">
          <button class="btn-icon bg-gray-200 hover:bg-gray-300 px-2 py-1 rounded-l-lg border border-gray-300 text-xs income-minus">
            <i class="fas fa-minus"></i>
          </button>
          <div class="relative">
            <input type="text" value="${b.income}" class="w-16 md:w-24 text-center border-t-2 border-b-2 border-gray-300 focus:outline-none py-1 mobile-input income-input income-field" maxlength="5">
            <span class="absolute right-1 md:right-2 top-1 text-gray-500 text-xs">‡∏ø</span>
          </div>
          <button class="btn-icon bg-gray-200 hover:bg-gray-300 px-2 py-1 rounded-r-lg border border-gray-300 text-xs income-plus">
            <i class="fas fa-plus"></i>
          </button>
        </div>
      </td>
      <td class="py-2 px-2 md:px-4">
        <div class="flex items-center justify-center">
          <button class="btn-icon bg-gray-200 hover:bg-gray-300 px-2 py-1 rounded-l-lg border border-gray-300 text-xs percent-minus">
            <i class="fas fa-minus"></i>
          </button>
          <input type="text" value="${b.percent}" class="w-8 md:w-12 text-center border-t-2 border-b-2 border-gray-300 focus:outline-none py-1 mobile-input percent-input">
          <button class="btn-icon bg-gray-200 hover:bg-gray-300 px-2 py-1 rounded-r-lg border border-gray-300 text-xs percent-plus">
            <i class="fas fa-plus"></i>
          </button>
        </div>
      </td>
      <td class="py-2 px-2 md:px-4 text-red-500 font-bold text-right text-xs md:text-sm">
        <i class="fas fa-arrow-down mr-1"></i>${cost.toLocaleString()}
      </td>
      <td class="py-2 px-2 md:px-4 text-green-600 font-bold text-right text-xs md:text-sm">
        <i class="fas fa-arrow-up mr-1"></i>${profit.toLocaleString()}
      </td>
      <td class="py-2 px-2 md:px-4">
        <input type="text" value="${b.location}" class="w-full border-2 border-gray-200 rounded-lg p-1 md:p-2 text-xs md:text-sm focus:border-[#ff6b2c] focus:outline-none transition-all mobile-input">
      </td>
      <td class="py-2 px-2 md:px-4 text-center">
        <button class="btn-icon bg-red-500 hover:bg-red-600 text-white py-1 px-2 rounded-lg text-xs">
          <i class="fas fa-trash"></i>
        </button>
      </td>
    `;
    tbody.appendChild(tr);

    // ‡∏™‡∏≤‡∏Ç‡∏≤
    tr.children[0].querySelector("input").addEventListener("input",(e)=>{b.name=e.target.value});

    // ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ
    const incomeInput = tr.children[1].querySelector("input");
    incomeInput.addEventListener("input",(e)=>{
      // ‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏Ñ‡πà‡∏≤‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 5 ‡∏´‡∏•‡∏±‡∏Å
      let value = e.target.value;
      if (value.length > 5) {
        value = value.substring(0, 5);
        e.target.value = value;
      }
      b.income=parseInt(value)||0;
      updateRowValues(tr, b);
      renderSummary();
    });
    
    tr.querySelector(".income-minus").addEventListener("click",()=>{
      b.income-=100; 
      if(b.income<0)b.income=0; 
      incomeInput.value = b.income;
      updateRowValues(tr, b);
      renderSummary();
    });
    
    tr.querySelector(".income-plus").addEventListener("click",()=>{
      // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏•‡πâ‡∏ß‡∏à‡∏∞‡πÄ‡∏Å‡∏¥‡∏ô 5 ‡∏´‡∏•‡∏±‡∏Å‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
      if (b.income < 99900) {
        b.income+=100; 
        if(b.income>99999)b.income=99999; // ‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏Ñ‡πà‡∏≤‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î
        incomeInput.value = b.income;
        updateRowValues(tr, b);
        renderSummary();
      }
    });

    // ‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå
    const percInput = tr.children[2].querySelector("input");
    percInput.addEventListener("input",(e)=>{
      b.percent=parseInt(e.target.value)||30; 
      if(b.percent<30)b.percent=30;
      if(b.percent>50)b.percent=50;
      percInput.value = b.percent;
      updateRowValues(tr, b);
      renderSummary();
    });
    
    tr.querySelector(".percent-minus").addEventListener("click",()=>{
      b.percent-=5;
      if(b.percent<30)b.percent=30; 
      percInput.value = b.percent;
      updateRowValues(tr, b);
      renderSummary();
    });
    
    tr.querySelector(".percent-plus").addEventListener("click",()=>{
      b.percent+=5;
      if(b.percent>50)b.percent=50; 
      percInput.value = b.percent;
      updateRowValues(tr, b);
      renderSummary();
    });

    // ‡πÇ‡∏•‡πÄ‡∏Ñ‡∏ä‡∏±‡πà‡∏ô
    tr.children[5].querySelector("input").addEventListener("input",(e)=>{b.location=e.target.value});

    // ‡∏•‡∏ö
    tr.children[6].querySelector("button").addEventListener("click",()=>{
      branches.splice(i,1);
      renderTable();
    });
  });
}

function updateRowValues(tr, branch) {
  const cost = (branch.income * branch.percent) / 100;
  const profit = branch.income - cost;
  
  tr.children[3].innerHTML = `<i class="fas fa-arrow-down mr-1"></i>${cost.toLocaleString()}`;
  tr.children[4].innerHTML = `<i class="fas fa-arrow-up mr-1"></i>${profit.toLocaleString()}`;
}

function getExpenses(){
  return {
    daily:parseInt(document.getElementById("daily").value)||0,
    fuel:parseInt(document.getElementById("fuel").value)||0,
    food:parseInt(document.getElementById("food").value)||0,
    other:parseInt(document.getElementById("other").value)||0
  };
}

function renderSummary(){
  const totalIncome = branches.reduce((a,b)=>a+b.income,0);
  const totalBranchCost = branches.reduce((a,b)=>a+(b.income*b.percent/100),0);
  const totalBranchProfit = totalIncome-totalBranchCost;
  const expenses = getExpenses();
  const totalExpenses = expenses.daily+expenses.fuel+expenses.food+expenses.other;
  const finalProfit = totalBranchProfit-totalExpenses;
  const avgPercent = branches.length?branches.reduce((a,b)=>a+b.percent,0)/branches.length:0;

  document.getElementById("summary1").innerHTML=`
    <div class="flex justify-between items-center">
      <span class="font-medium text-sm md:text-base">‡∏£‡∏ß‡∏°‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ:</span>
      <span class="font-bold text-lg md:text-xl">${totalIncome.toLocaleString()} ‡∏ø</span>
    </div>
    <div class="flex justify-between items-center">
      <span class="font-medium text-sm md:text-base">‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏™‡∏≤‡∏Ç‡∏≤ (${avgPercent.toFixed(0)}%):</span>
      <span class="font-bold text-lg md:text-xl">${totalBranchCost.toLocaleString()} ‡∏ø</span>
    </div>
    <div class="flex justify-between items-center border-t border-white/30 pt-3">
      <span class="font-medium text-sm md:text-base">‡∏Å‡∏≥‡πÑ‡∏£‡∏™‡∏≤‡∏Ç‡∏≤:</span>
      <span class="font-bold text-lg md:text-xl">${totalBranchProfit.toLocaleString()} ‡∏ø</span>
    </div>
  `;
  document.getElementById("summary2").innerHTML=`
    <div class="flex justify-between items-center">
      <span class="font-medium text-sm md:text-base">‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°:</span>
      <span class="font-bold text-lg md:text-xl">${totalExpenses.toLocaleString()} ‡∏ø</span>
    </div>
    <div class="flex justify-between items-center border-t border-white/30 pt-3">
      <span class="font-medium text-sm md:text-base">‡∏Å‡∏≥‡πÑ‡∏£‡∏™‡∏∏‡∏ó‡∏ò‡∏¥:</span>
      <span class="font-bold text-xl md:text-2xl">${finalProfit.toLocaleString()} ‡∏ø</span>
    </div>
  `;
}

// Modal Functions
function openModal(modalId) {
  document.getElementById(modalId).style.display = "block";
  
  // ‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ç‡∏≠‡∏á modal
  if (modalId === 'calculateModal') {
    playSound('calculateSound');
  } else if (modalId === 'resetModal') {
    playSound('resetSound');
  } else if (modalId === 'sendDataModal') {
    playSound('sendSound');
  } else if (modalId === 'loadLatestDataModal') {
    playSound('loadSound');
  }
}

function closeModal(modalId) {
  document.getElementById(modalId).style.display = "none";
}

// Function to play sound
function playSound(soundId) {
  const sound = document.getElementById(soundId);
  if (sound) {
    sound.currentTime = 0; // Reset audio to beginning
    sound.play().catch(e => console.log("Audio play failed:", e));
  }
}

// ‡∏õ‡∏∏‡πà‡∏°
document.getElementById("addBranch").addEventListener("click",()=>{
  branches.push({name:`‡∏™‡∏≤‡∏Ç‡∏≤ ${branches.length+1}`, income:0, percent:30, location:""});
  renderTable();
});

document.getElementById("reset").addEventListener("click",()=>{
  openModal('resetModal');
});

function confirmReset() {
  branches=Array.from({length:INITIAL_BRANCHES}, (_,i)=>({name:`‡∏™‡∏≤‡∏Ç‡∏≤ ${i+1}`, income:0, percent:30, location:""}));
  document.getElementById("daily").value="";
  document.getElementById("fuel").value="";
  document.getElementById("food").value="";
  document.getElementById("other").value="";
  document.getElementById("date").value="";
  document.getElementById("formattedDate").textContent="";
  document.getElementById("summary1").innerHTML = "";
  document.getElementById("summary2").innerHTML = "";
  renderTable();
  closeModal('resetModal');
}

document.getElementById("exportCSV").addEventListener("click",()=>{
  const header=["‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà","‡∏™‡∏≤‡∏Ç‡∏≤","‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ (‡∏ö‡∏≤‡∏ó)","% ‡πÄ‡∏Å‡πá‡∏ö","‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢ (‡∏ö‡∏≤‡∏ó)","‡∏Å‡∏≥‡πÑ‡∏£ (‡∏ö‡∏≤‡∏ó)","‡πÇ‡∏•‡πÄ‡∏Ñ‡∏ä‡∏±‡πà‡∏ô"];
  const date = document.getElementById("date").value;
  const dateRow=[formatThaiDate(date),"","","","","",""];
  const rows = branches.map(b=>["",b.name,b.income,b.percent,(b.income*b.percent/100),(b.income-(b.income*b.percent/100)),b.location]);
  const expenses=getExpenses();
  const summary=[
    ["","‡∏£‡∏ß‡∏°‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ", branches.reduce((a,b)=>a+b.income,0)],
    ["","‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏™‡∏≤‡∏Ç‡∏≤", branches.reduce((a,b)=>a+(b.income*b.percent/100),0)],
    ["","‡∏Å‡∏≥‡πÑ‡∏£‡∏™‡∏≤‡∏Ç‡∏≤", branches.reduce((a,b)=>a+b.income-(b.income*b.percent/100),0)],
    ["","‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°", expenses.daily+expenses.fuel+expenses.food+expenses.other],
    ["","‡∏Å‡∏≥‡πÑ‡∏£‡∏™‡∏∏‡∏ó‡∏ò‡∏¥",(branches.reduce((a,b)=>a+b.income-(b.income*b.percent/100),0)-(expenses.daily+expenses.fuel+expenses.food+expenses.other))]
  ];
  const csvContent="\uFEFF"+[header,dateRow,...rows,[],...summary].map(r=>r.join(",")).join("\n");
  const blob=new Blob([csvContent], {type:"text/csv;charset=utf-8;"});
  const link=document.createElement("a");
  link.href=URL.createObjectURL(blob);
  link.setAttribute("download",`‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô_${date||"‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà"}.csv`);
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
});

// ‡∏õ‡∏∏‡πà‡∏°‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì
document.getElementById("calculate").addEventListener("click",()=>{
  renderSummary();
  
  // ‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏î‡πâ‡∏ß‡∏¢ animation
  const summaryCards = document.querySelectorAll('.summary-card, .expense-card');
  summaryCards.forEach((card, index) => {
    setTimeout(() => {
      card.style.animation = 'fadeIn 0.5s ease forwards';
    }, index * 200);
  });
  
  // ‡πÅ‡∏™‡∏î‡∏á modal ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì
  showCalculateModal();
});

function showCalculateModal() {
  const totalIncome = branches.reduce((a,b)=>a+b.income,0);
  const totalBranchCost = branches.reduce((a,b)=>a+(b.income*b.percent/100),0);
  const totalBranchProfit = totalIncome-totalBranchCost;
  const expenses = getExpenses();
  const totalExpenses = expenses.daily+expenses.fuel+expenses.food+expenses.other;
  const finalProfit = totalBranchProfit-totalExpenses;
  const avgPercent = branches.length?branches.reduce((a,b)=>a+b.percent,0)/branches.length:0;
  
  document.getElementById("modalSummary").innerHTML = `
    <div class="summary-item">
      <span>‡∏£‡∏ß‡∏°‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ:</span>
      <span class="font-bold">${totalIncome.toLocaleString()} ‡∏ø</span>
    </div>
    <div class="summary-item">
      <span>‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡∏™‡∏≤‡∏Ç‡∏≤ (${avgPercent.toFixed(0)}%):</span>
      <span class="font-bold">${totalBranchCost.toLocaleString()} ‡∏ø</span>
    </div>
    <div class="summary-item">
      <span>‡∏Å‡∏≥‡πÑ‡∏£‡∏™‡∏≤‡∏Ç‡∏≤:</span>
      <span class="font-bold">${totalBranchProfit.toLocaleString()} ‡∏ø</span>
    </div>
    <div class="summary-item">
      <span>‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°:</span>
      <span class="font-bold">${totalExpenses.toLocaleString()} ‡∏ø</span>
    </div>
    <div class="summary-item">
      <span>‡∏Å‡∏≥‡πÑ‡∏£‡∏™‡∏∏‡∏ó‡∏ò‡∏¥:</span>
      <span class="font-bold text-lg">${finalProfit.toLocaleString()} ‡∏ø</span>
    </div>
  `;
  
  openModal('calculateModal');
}

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏à‡∏≤‡∏Å Google Sheet
function loadLatestData() {
  // ‡πÄ‡∏õ‡∏¥‡∏î Modal ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
  document.getElementById("loadLatestStatus").innerHTML = `
    <div class="loading-spinner"></div>
    <p class="text-lg">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î...</p>
  `;
  
  document.getElementById("modalLoadLatestSummary").innerHTML = "";
  document.getElementById("confirmLoadLatest").style.display = "none";
  openModal('loadLatestDataModal');
  
  // URL ‡∏Ç‡∏≠‡∏á Google Apps Script Web App ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
  const url = `https://script.google.com/macros/s/AKfycbzDXoRZhsJj2HVUNZyssAp-kOfSgyTPrnpARzLFuCe-t54h0xqs3MfmWYKlquEPgWF2xg/exec?action=latestData`;
  
  console.log("Loading latest data from:", url);
  
  fetch(url)
    .then(response => {
      console.log("Response status:", response.status);
      if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
      }
      return response.json();
    })
    .then(data => {
      console.log("Latest data loaded from server:", data);
      
      if (data.result === 'success') {
        // ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
        document.getElementById("loadLatestStatus").innerHTML = `
          <div class="mb-4">
            <i class="fas fa-check-circle text-5xl text-green-500 mb-3"></i>
            <p class="text-lg">‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</p>
            <p class="text-gray-600">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ${data.data.date} ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà ${data.data.time} ‡∏ñ‡∏π‡∏Å‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß</p>
          </div>
        `;
        
        // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏î‡∏∂‡∏á‡∏°‡∏≤
        if (data.data) {
          let summaryHtml = `
            <div class="summary-item">
              <span>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</span>
              <span class="font-bold">${data.data.date}</span>
            </div>
            <div class="summary-item">
              <span>‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà:</span>
              <span class="font-bold">${data.data.time}</span>
            </div>
            <div class="summary-item">
              <span>‡πÄ‡∏ß‡∏•‡∏≤:</span>
              <span class="font-bold">${data.data.timestamp}</span>
            </div>
            <div class="summary-item">
              <span>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏≤‡∏Ç‡∏≤:</span>
              <span class="font-bold">${data.data.rows ? data.data.rows.length : 0} ‡∏™‡∏≤‡∏Ç‡∏≤</span>
            </div>
          `;
          
          if (data.data.totals) {
            summaryHtml += `
              <div class="summary-item">
                <span>‡∏£‡∏ß‡∏°‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ:</span>
                <span class="font-bold">${data.data.totals.totalIncome.toLocaleString()} ‡∏ø</span>
              </div>
              <div class="summary-item">
                <span>‡∏Å‡∏≥‡πÑ‡∏£‡∏™‡∏∏‡∏ó‡∏ò‡∏¥:</span>
                <span class="font-bold">${data.data.totals.finalProfit.toLocaleString()} ‡∏ø</span>
              </div>
            `;
          }
          
          document.getElementById("modalLoadLatestSummary").innerHTML = summaryHtml;
          
          // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏õ‡∏∏‡πà‡∏°‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
          document.getElementById("confirmLoadLatest").style.display = "inline-block";
          document.getElementById("confirmLoadLatest").onclick = function() {
            // ‡∏ô‡∏≥‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏°‡∏≤‡πÅ‡∏™‡∏î‡∏á‡πÉ‡∏ô‡∏ü‡∏≠‡∏£‡πå‡∏°
            if (data.data) {
              // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°
              if (data.data.expenses) {
                document.getElementById("daily").value = data.data.expenses.daily || 0;
                document.getElementById("fuel").value = data.data.expenses.fuel || 0;
                document.getElementById("food").value = data.data.expenses.food || 0;
                document.getElementById("other").value = data.data.expenses.other || 0;
              }
              
              // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≤‡∏Ç‡∏≤
              if (data.data.rows && data.data.rows.length > 0) {
                // ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≤‡∏Ç‡∏≤‡πÄ‡∏î‡∏¥‡∏°
                branches = [];
                
                // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≤‡∏Ç‡∏≤‡πÉ‡∏´‡∏°‡πà
                data.data.rows.forEach(row => {
                  branches.push({
                    name: row.name || "",
                    income: parseInt(row.income) || 0,
                    percent: parseInt(row.percent) || 30,
                    location: row.location || ""
                  });
                });
                
                // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ï‡∏≤‡∏£‡∏≤‡∏á
                renderTable();
              }
              
              // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏™‡∏£‡∏∏‡∏õ‡πÉ‡∏´‡∏°‡πà
              renderSummary();
            }
            
            closeModal('loadLatestDataModal');
          };
        }
      } else {
        // ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß
        document.getElementById("loadLatestStatus").innerHTML = `
          <div class="mb-4">
            <i class="fas fa-exclamation-circle text-5xl text-red-500 mb-3"></i>
            <p class="text-lg">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î!</p>
            <p class="text-gray-600">${data.message || '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö'}</p>
          </div>
        `;
      }
    })
    .catch(err => {
      console.error("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î:", err);
      
      // ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß
      document.getElementById("loadLatestStatus").innerHTML = `
        <div class="mb-4">
          <i class="fas fa-exclamation-circle text-5xl text-red-500 mb-3"></i>
          <p class="text-lg">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î!</p>
          <p class="text-gray-600">‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ‡πÉ‡∏ô‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ: ${err.message}</p>
        </div>
      `;
    });
}

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡∏¢‡∏±‡∏á Google Sheet
function sendData() {
  // ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà
  const date = document.getElementById("date").value;
  const formattedDate = formatThaiDate(date);

  // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
  if (!date) {
    alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•");
    return;
  }
  
  // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
  if (!formattedDate) {
    alert("‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏´‡∏°‡πà");
    return;
  }

  // ‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°
  const expenses = {
    daily: parseInt(document.getElementById("daily").value) || 0,
    fuel: parseInt(document.getElementById("fuel").value) || 0,
    food: parseInt(document.getElementById("food").value) || 0,
    other: parseInt(document.getElementById("other").value) || 0,
  };

  // ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏≤‡∏Ç‡∏≤
  const rows = branches.map(b => ({
    name: b.name,
    income: b.income,
    percent: b.percent,
    location: b.location || "",
  }));

  // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡πà‡∏≤‡∏£‡∏ß‡∏°
  const totalIncome = branches.reduce((a, b) => a + b.income, 0);
  const totalBranchCost = branches.reduce((a, b) => a + (b.income * b.percent / 100), 0);
  const totalBranchProfit = totalIncome - totalBranchCost;
  const totalExpenses = expenses.daily + expenses.fuel + expenses.food + expenses.other;
  const finalProfit = totalBranchProfit - totalExpenses;

  // ‡∏£‡∏ß‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
  const payload = {
    date: formattedDate,
    rows: rows,
    expenses: expenses,
    totals: {
      totalIncome: totalIncome,
      totalBranchCost: totalBranchCost,
      totalBranchProfit: totalBranchProfit,
      totalExpenses: totalExpenses,
      finalProfit: finalProfit
    }
  };

  console.log("üì§ ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•:", payload);

  // ‡πÅ‡∏™‡∏î‡∏á Modal ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
  showSendDataModal(payload);
}

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á Modal ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
function showSendDataModal(payload) {
  document.getElementById("modalSendSummary").innerHTML = `
    <div class="summary-item">
      <span>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</span>
      <span class="font-bold">${payload.date}</span>
    </div>
    <div class="summary-item">
      <span>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏™‡∏≤‡∏Ç‡∏≤:</span>
      <span class="font-bold">${payload.rows.length} ‡∏™‡∏≤‡∏Ç‡∏≤</span>
    </div>
    <div class="summary-item">
      <span>‡∏£‡∏ß‡∏°‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ:</span>
      <span class="font-bold">${payload.totals.totalIncome.toLocaleString()} ‡∏ø</span>
    </div>
    <div class="summary-item">
      <span>‡∏Å‡∏≥‡πÑ‡∏£‡∏™‡∏∏‡∏ó‡∏ò‡∏¥:</span>
      <span class="font-bold">${payload.totals.finalProfit.toLocaleString()} ‡∏ø</span>
    </div>
  `;
  
  // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏õ‡∏∏‡πà‡∏°‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á
  document.getElementById("confirmSend").onclick = function() {
    // ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
    document.getElementById("sendStatus").innerHTML = `
      <div class="loading-spinner"></div>
      <p class="text-lg">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
    `;
    
    // ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡∏¢‡∏±‡∏á Google Script
    sendToGoogleSheet(payload);
  };
  
  openModal('sendDataModal');
}

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡∏¢‡∏±‡∏á Google Sheet ‡πÇ‡∏î‡∏¢‡πÄ‡∏â‡∏û‡∏≤‡∏∞
function sendToGoogleSheet(payload) {
  // ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
  document.getElementById("sendStatus").innerHTML = `
    <div class="loading-spinner"></div>
    <p class="text-lg">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
  `;
  
  // URL ‡∏Ç‡∏≠‡∏á Google Apps Script Web App
  const url = "https://script.google.com/macros/s/AKfycbzDXoRZhsJj2HVUNZyssAp-kOfSgyTPrnpARzLFuCe-t54h0xqs3MfmWYKlquEPgWF2xg/exec";
  
  // ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ö‡∏ö JSON
  fetch(url, {
    method: 'POST',
    mode: 'no-cors', // ‡πÉ‡∏ä‡πâ no-cors ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏´‡∏•‡∏µ‡∏Å‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤ CORS
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify(payload)
  })
  .then(response => {
    // ‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å‡πÉ‡∏ä‡πâ no-cors ‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡πà‡∏≤‡∏ô response ‡πÑ‡∏î‡πâ
    // ‡∏î‡∏±‡∏á‡∏ô‡∏±‡πâ‡∏ô‡πÄ‡∏£‡∏≤‡∏à‡∏∞‡∏™‡∏°‡∏°‡∏ï‡∏¥‡∏ß‡πà‡∏≤‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÄ‡∏™‡∏°‡∏≠
    console.log("Data sent successfully");
    
    // ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
    document.getElementById("sendStatus").innerHTML = `
      <div class="mb-4">
        <i class="fas fa-check-circle text-5xl text-green-500 mb-3"></i>
        <p class="text-lg">‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</p>
        <p class="text-gray-600">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏π‡∏Å‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏¢‡∏±‡∏á Google Sheet ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß</p>
        <p class="text-gray-500 text-sm mt-2">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏à‡∏≥‡∏Å‡∏±‡∏î‡∏Ç‡∏≠‡∏á‡∏£‡∏∞‡∏ö‡∏ö ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏à‡∏≤‡∏Å Google Sheet ‡πÑ‡∏î‡πâ</p>
      </div>
    `;
    
    // ‡∏ã‡πà‡∏≠‡∏ô‡∏õ‡∏∏‡πà‡∏°‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á
    document.getElementById("confirmSend").style.display = "none";
  })
  .catch(error => {
    console.error('Error sending data:', error);
    
    // ‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß
    document.getElementById("sendStatus").innerHTML = `
      <div class="mb-4">
        <i class="fas fa-exclamation-circle text-5xl text-red-500 mb-3"></i>
        <p class="text-lg">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î!</p>
        <p class="text-gray-600">‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ: ${error.message}</p>
        <p class="text-gray-500 text-sm mt-2">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï‡πÅ‡∏•‡∏∞‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</p>
      </div>
    `;
    
    // ‡∏ã‡πà‡∏≠‡∏ô‡∏õ‡∏∏‡πà‡∏°‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á
    document.getElementById("confirmSend").style.display = "none";
  });
}

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠
function checkConnection() {
  const url = "https://script.google.com/macros/s/AKfycbzDXoRZhsJj2HVUNZyssAp-kOfSgyTPrnpARzLFuCe-t54h0xqs3MfmWYKlquEPgWF2xg/exec";
  
  console.log("üîç ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö:", url);
  
  fetch(url + "?action=ping")
    .then(response => {
      if (!response.ok) {
        throw new Error(`HTTP error! status: ${response.status}`);
      }
      return response.json();
    })
    .then(data => {
      console.log("‚úÖ ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:", data);
      alert("‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!\n" + JSON.stringify(data));
    })
    .catch(err => {
      console.error("‚ùå ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß:", err);
      alert("‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: " + err.message);
    });
}

// ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà
document.getElementById("date").addEventListener("input",(e)=>{
  const formattedDate = formatThaiDate(e.target.value);
  document.getElementById("formattedDate").textContent="‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å: "+formattedDate;
});

// ‡∏Ñ‡πà‡∏≤‡πÉ‡∏ä‡πâ‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° - ‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏î
document.querySelectorAll('#daily, #fuel, #food, #other').forEach((input, index) => {
  const buttons = input.parentElement.parentElement.querySelectorAll('button');
  const minusBtn = buttons[0];
  const plusBtn = buttons[1];
  
  // ‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏î
  minusBtn.addEventListener('click', () => {
    const currentValue = parseInt(input.value) || 0;
    const newValue = Math.max(0, currentValue - 100);
    input.value = newValue;
    renderSummary();
  });
  
  // ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°
  plusBtn.addEventListener('click', () => {
    const currentValue = parseInt(input.value) || 0;
    const newValue = currentValue + 100;
    input.value = newValue;
    renderSummary();
  });
  
  // ‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏°‡∏û‡πå‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á
  input.addEventListener('input', () => {
    renderSummary();
  });
});

// ‡∏õ‡∏¥‡∏î modal ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ô‡∏≠‡∏Å‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà modal
window.onclick = function(event) {
  const calculateModal = document.getElementById("calculateModal");
  const resetModal = document.getElementById("resetModal");
  const sendDataModal = document.getElementById("sendDataModal");
  const loadLatestDataModal = document.getElementById("loadLatestDataModal");
  
  if (event.target == calculateModal) {
    calculateModal.style.display = "none";
  }
  if (event.target == resetModal) {
    resetModal.style.display = "none";
  }
  if (event.target == sendDataModal) {
    sendDataModal.style.display = "none";
  }
  if (event.target == loadLatestDataModal) {
    loadLatestDataModal.style.display = "none";
  }
}

// ‡∏ú‡∏π‡∏Å‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏±‡∏ö‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô
document.getElementById("sendData").addEventListener("click", sendData);
document.getElementById("loadLatestData").addEventListener("click", loadLatestData);
document.getElementById("testSend").addEventListener("click", testSendData);
document.getElementById("checkConnection").addEventListener("click", checkConnection);

// Render ‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å
renderTable();
</script>
</body>
</html>
